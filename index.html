<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AMS Financials Overview 2025</title>
    
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Chart.js for creating the chart -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- Lucide Icons for icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        /* Custom font and base styling */
        body {
            font-family: 'Inter', sans-serif;
        }
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap');
    </style>
</head>
<body class="bg-slate-50">

    <div class="p-4 sm:p-6 lg:p-8">
        <div class="max-w-7xl mx-auto">
            <!-- Header Section -->
            <header class="mb-8">
                <h1 class="text-3xl font-bold text-gray-900">AMS Financials Overview 2025</h1>
                <p class="text-md text-gray-600 mt-1">Budget vs. Actuals & Forecast Analysis</p>
            </header>

            <!-- KPI Cards Grid -->
            <div id="kpi-cards" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                <!-- Info cards will be injected here by JavaScript -->
            </div>

            <!-- Chart Container -->
            <div class="bg-white rounded-xl shadow-md p-4 sm:p-6">
                <h2 class="text-xl font-semibold text-gray-800 mb-1">Financial Performance</h2>
                <p class="text-sm text-gray-500 mb-6">Monthly figures and cumulative forecast against total budget.</p>
                <div class="relative h-[500px]">
                    <canvas id="financialChart"></canvas>
                </div>
            </div>

            <!-- Insights & Recommendations Box -->
            <div id="insights-box" class="mt-8 bg-amber-50 border-l-4 border-amber-400 p-4 rounded-r-lg">
                 <!-- Insights content will be injected here by JavaScript -->
            </div>
        </div>
    </div>

    <script>
        // --- DATA ---
        // This is the raw data, just like in the React version.
        const rawData = [
            { MONTH: 'MARCH', "Budget per Month": 34828, "Actuals & Estimate Burnrate": 47000, "Cummulative Forecast": 47000, "Total Budget": 417000 },
            { MONTH: 'APRIL', "Budget per Month": 34828, "Actuals & Estimate Burnrate": 47000, "Cummulative Forecast": 94000, "Total Budget": 417000 },
            { MONTH: 'MAY', "Budget per Month": 34828, "Actuals & Estimate Burnrate": 47000, "Cummulative Forecast": 141000, "Total Budget": 417000 },
            { MONTH: 'JUNE', "Budget per Month": 34828, "Actuals & Estimate Burnrate": 44134, "Cummulative Forecast": 185134, "Total Budget": 417000 },
            { MONTH: 'JULY', "Budget per Month": 34828, "Actuals & Estimate Burnrate": 46000, "Cummulative Forecast": 231134, "Total Budget": 417000 },
            { MONTH: 'AUGUST', "Budget per Month": 34828, "Actuals & Estimate Burnrate": 46000, "Cummulative Forecast": 277134, "Total Budget": 417000 },
            { MONTH: 'SEPTEMBER', "Budget per Month": 34828, "Actuals & Estimate Burnrate": 46000, "Cummulative Forecast": 323134, "Total Budget": 417000 },
            { MONTH: 'OCTOBER', "Budget per Month": 34828, "Actuals & Estimate Burnrate": 22000, "Cummulative Forecast": 345134, "Total Budget": 417000 },
            { MONTH: 'NOVEMBER', "Budget per Month": 34828, "Actuals & Estimate Burnrate": 22000, "Cummulative Forecast": 367134, "Total Budget": 417000 },
            { MONTH: 'DECEMBER', "Budget per Month": 34828, "Actuals & Estimate Burnrate": 22000, "Cummulative Forecast": 389134, "Total Budget": 417000 },
            { MONTH: 'JANUARY', "Budget per Month": 34828, "Actuals & Estimate Burnrate": 22000, "Cummulative Forecast": 411134, "Total Budget": 417000 },
            { MONTH: 'FEBRUARY', "Budget per Month": 34828, "Actuals & Estimate Burnrate": 22000, "Cummulative Forecast": 433134, "Total Budget": 417000 }
        ];

        // --- UTILITY FUNCTIONS ---
        // Formats a number into a Dutch Euro currency string.
        const formatCurrency = (value) => new Intl.NumberFormat('nl-NL', { style: 'currency', currency: 'EUR' }).format(value);

        // --- DOM MANIPULATION ---
        // Function to create and inject an Info Card.
        const createInfoCard = (title, value, iconName, color, description) => {
            const card = document.createElement('div');
            card.className = "bg-white rounded-xl shadow-md p-6 flex flex-col justify-between border-l-4";
            card.style.borderColor = color;

            card.innerHTML = `
                <div>
                    <div class="flex items-center justify-between mb-2">
                        <p class="text-sm font-medium text-gray-500">${title}</p>
                        <i data-lucide="${iconName}" style="color: ${color};"></i>
                    </div>
                    <p class="text-3xl font-bold text-gray-800">${value}</p>
                </div>
                <p class="text-xs text-gray-500 mt-3">${description}</p>
            `;
            return card;
        };

        // --- MAIN LOGIC ---
        // This function runs when the page loads.
        document.addEventListener('DOMContentLoaded', () => {
            // 1. Process Data to Calculate KPIs
            const totalBudget = rawData.length > 0 ? rawData[0]['Total Budget'] : 0;
            const projectedSpend = rawData.length > 0 ? rawData[rawData.length - 1]['Cummulative Forecast'] : 0;
            const overspend = projectedSpend - totalBudget;
            const crossover = rawData.find(d => d['Cummulative Forecast'] > totalBudget);
            const crossoverMonth = crossover ? crossover.MONTH : 'N/A';
            const crossoverIndex = rawData.findIndex(d => d['Cummulative Forecast'] > totalBudget);
            
            // 2. Render KPI Cards
            const kpiContainer = document.getElementById('kpi-cards');
            kpiContainer.appendChild(createInfoCard('Total Budget', formatCurrency(totalBudget), 'target', '#3b82f6', 'The total allocated budget for the project.'));
            kpiContainer.appendChild(createInfoCard('Projected Total Spend', formatCurrency(projectedSpend), 'arrow-up-right', '#f59e0b', 'Estimated total cost based on current burn rate.'));
            kpiContainer.appendChild(createInfoCard('Projected Overspend', formatCurrency(overspend), 'alert-triangle', '#ef4444', `Projected to be ${formatCurrency(Math.abs(overspend))} over budget.`));
            kpiContainer.appendChild(createInfoCard('Budget Crossover', crossoverMonth, 'trending-down', '#10b981', 'The month when spending is forecasted to exceed the total budget.'));

            // 3. Render Insights Box
            const insightsContainer = document.getElementById('insights-box');
            insightsContainer.innerHTML = `
                <div class="flex">
                    <div class="flex-shrink-0">
                        <i data-lucide="alert-triangle" class="h-5 w-5 text-amber-500"></i>
                    </div>
                    <div class="ml-3">
                        <h3 class="text-md font-medium text-amber-800">Key Insights & Recommendations</h3>
                        <div class="mt-2 text-sm text-amber-700">
                            <p>The analysis indicates a projected overspend of <span class="font-bold">${formatCurrency(overspend)}</span>. The cumulative forecast is set to exceed the total budget in <span class="font-bold">${crossoverMonth}</span>.</p>
                        </div>
                    </div>
                </div>
            `;


            // This command finds all i tags with a 'data-lucide' attribute and replaces them with SVG icons.
            lucide.createIcons();

            // 4. Prepare Data for Chart.js
            const chartLabels = rawData.map(d => d.MONTH);
            const chartData = {
                labels: chartLabels,
                datasets: [
                    {
                        type: 'bar',
                        label: 'Monthly Budget',
                        data: rawData.map(d => d['Budget per Month']),
                        backgroundColor: '#a7f3d0',
                        yAxisID: 'yLeft',
                        borderRadius: 4,
                    },
                    {
                        type: 'bar',
                        label: 'Actuals/Forecast',
                        data: rawData.map(d => d['Actuals & Estimate Burnrate']),
                        backgroundColor: '#082e59',
                        yAxisID: 'yLeft',
                        borderRadius: 4,
                    },
                    {
                        type: 'line',
                        label: 'Cumulative Forecast',
                        data: rawData.map(d => d['Cummulative Forecast']),
                        borderColor: '#059669',
                        backgroundColor: '#059669',
                        yAxisID: 'yRight',
                        tension: 0.3,
                        borderWidth: 3,
                        pointRadius: 4,
                        pointHoverRadius: 8
                    },
                    {
                        type: 'line',
                        label: 'Total Budget',
                        data: rawData.map(d => d['Total Budget']),
                        borderColor: '#ef4444',
                        backgroundColor: 'transparent', // This makes the legend's background box invisible
                        borderDash: [5, 5],
                        yAxisID: 'yRight',
                        borderWidth: 3,
                        pointRadius: 0, // No dots on this line
                    },
                     {
                        type: 'line',
                        label: 'Overspend Point',
                        data: rawData.map((d, index) => index === crossoverIndex ? d['Cummulative Forecast'] : null),
                        borderColor: '#ef4444',
                        backgroundColor: '#ef4444',
                        yAxisID: 'yRight',
                        pointStyle: 'circle',
                        pointRadius: 6,
                        pointHoverRadius: 10,
                        borderWidth: 0, // We only want to show the point
                        showLine: false,
                    }
                ]
            };

            // 5. Create Chart
            const ctx = document.getElementById('financialChart').getContext('2d');
            new Chart(ctx, {
                data: chartData,
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                        mode: 'index',
                        intersect: false,
                    },
                    scales: {
                        x: {
                            ticks: {
                                font: { size: 12 },
                                color: '#6b7280',
                                maxRotation: 45,
                                minRotation: 45,
                            },
                            grid: {
                                display: false
                            }
                        },
                        yLeft: {
                            type: 'linear',
                            position: 'left',
                            title: {
                                display: true,
                                text: 'Monthly Amount (€)',
                                color: '#4b5563',
                                font: { size: 14 }
                            },
                            ticks: {
                                font: { size: 12 },
                                color: '#6b7280',
                                callback: value => `€${value / 1000}k`
                            },
                        },
                        yRight: {
                            type: 'linear',
                            position: 'right',
                            title: {
                                display: true,
                                text: 'Cumulative Amount (€)',
                                color: '#4b5563',
                                font: { size: 14 }
                            },
                            ticks: {
                                font: { size: 12 },
                                color: '#6b7280',
                                callback: value => `€${value / 1000}k`
                            },
                            grid: {
                                drawOnChartArea: false, // only show grid for left axis
                            },
                        }
                    },
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                padding: 20
                            }
                        },
                        tooltip: {
                            enabled: true,
                            backgroundColor: '#ffffff',
                            titleColor: '#1f2937',
                            bodyColor: '#4b5563',
                            borderColor: '#e5e7eb',
                            borderWidth: 1,
                            padding: 15,
                            callbacks: {
                                label: function(context) {
                                    let label = context.dataset.label || '';
                                    if (label) {
                                        label += ': ';
                                    }
                                    if (context.parsed.y !== null) {
                                        label += formatCurrency(context.parsed.y);
                                    }
                                    return label;
                                }
                            }
                        }
                    }
                }
            });
        });
    </script>
</body>
</html>
